<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- reset css -->
    <link rel="stylesheet" href="assets/css/reset.css">
    <!-- Google font CDN -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Inconsolata|Playfair+Display|Rubik">
    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <!-- style css -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Jquery CDN -->
    <script src="https://code.jquery.com/jquery-3.4.0.slim.js"
        integrity="sha256-milezx5lakrZu0OP9b2QWFy1ft/UEUK6NH1Jqz8hUhQ=" crossorigin="anonymous"></script>

    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

    <!-- d3org CDN (used for color circle $ hexagon) -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="canonical" href="https://d3js.org/">

    <title>Meme Mail</title>
</head>

<body>
    <div class="container">
        <svg width="1060" height="500"></svg>
        <div id="wrapper">
            <div id="letters">
                <div class="m">m</div>
                <div class="e">e</div>
                <div class="mm">m</div>
                <div class="eea">e</div>
                <div class="mmm">m</div>
                <div class="eea">a</div>
                <div class="i">i</div>
                <div class="l">l</div>
                <br />
                <div class="line"></div>

                <p class="description">
                    Send your friend the best meme
                </p>
            </div>
            <div class="scroll-overlay"></div>
        </div>
        <div class="links">
            <div class="card quickstart col-sm-8">
                <div class="row justify-content-start ">
                    <div class="col-sm-12">
                        <form>
                            <div class="form-group">
                                <label for="inputMeme">Choose a meme</label>
                                <input type="Meme" class="form-control" id="inputMeme" placeholder="something">
                                <!-- <button type="search" class="btn btn-primary">Search</button> -->
                                <a class="btn btn-sm" href="#!" role="button" id="search_button"><i
                                        class="fas fa-fire"></i>
                                    Add</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Giphy API Display -->
            <div class="card quickstart col-sm-8">


                <div class="row">
                    <div class="col-sm-12 bordertest">
                        <h1>Gif Results:</h1>
                        <div id="gifs-display"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 bordertest">
                        <h1>Random Results:</h1>
                        <div id="randomGifs-display"></div>
                    </div>
                </div>


            </div>


            <div class="card quickstart col-sm-8">
                <div id="examples">
                    <div id="examples-deep"></div>
                </div>
            </div>
            <div class="card quickstart col-sm-8">
                <div class="row justify-content-start ">
                    <div class="col-sm-12">
                        <form>
                            <div class="form-group">
                                <label for="inputVictim">Choose a Victim</label>
                                <input type="text" class="form-control" id="inputVictim"
                                    placeholder="someone@gitrekt.com">
                            </div>
                            <div class="form-group">
                                <label for="inputMessage">Add a message</label>
                                <input type="text" class="form-control" id="inputMessage"
                                    placeholder="something something">
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>

                        <!-- GMAIL API INTEGRATE IT SOMEHOW -->
                        <button id="authorize-button" class="btn btn-primary hidden">Authorize</button>

                        <form onsubmit="return sendEmail();">
                            <div class="modal-body">
                                <div class="form-group">
                                    <input type="email" class="form-control" id="compose-to" placeholder="To"
                                        required />
                                </div>

                                <div class="form-group">
                                    <input type="text" class="form-control" id="compose-subject" placeholder="Subject"
                                        required />
                                </div>

                                <div class="form-group">
                                    <textarea class="form-control" id="compose-message" placeholder="Message" rows="10"
                                        required></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="submit" id="send-button" class="btn btn-primary">Send</button>
                            </div>
                        </form>


                        <!------------------------------- gmailAPI JAVASCRIPT ---------------------------------------->

                        <!-- <script type="text/javascript">
                            var clientId = '796714123214-c2l83ece577rjvsfq1frveos1buijo1u.apps.googleusercontent.com';
                            var apiKey = 'AIzaSyBjIPFf-EIox8cC0cXAnDwbZFOy_w2M_RQ';
                            var scopes =
                                'https://www.googleapis.com/auth/gmail.readonly ' +
                                'https://www.googleapis.com/auth/gmail.send';

                            function handleClientLoad() {
                                gapi.client.setApiKey(apiKey);
                                window.setTimeout(checkAuth, 1);
                            }

                            function checkAuth() {
                                gapi.auth.authorize({
                                    client_id: clientId,
                                    scope: scopes,
                                    immediate: true
                                }, handleAuthResult);
                            }

                            function handleAuthClick() {
                                gapi.auth.authorize({
                                    client_id: clientId,
                                    scope: scopes,
                                    immediate: false
                                }, handleAuthResult);
                                return false;
                            }

                            function handleAuthResult(authResult) {
                                if (authResult && !authResult.error) {
                                    loadGmailApi();
                                    $('#authorize-button').remove();
                                    $('.table-inbox').removeClass("hidden");
                                    $('#compose-button').removeClass("hidden");
                                } else {
                                    $('#authorize-button').removeClass("hidden");
                                    $('#authorize-button').on('click', function () {
                                        handleAuthClick();
                                    });
                                }
                            }

                            function loadGmailApi() {
                                gapi.client.load('gmail', 'v1', displayInbox);
                            }

                            function displayInbox() {
                                var request = gapi.client.gmail.users.messages.list({
                                    'userId': 'me',
                                    'labelIds': 'INBOX',
                                    'maxResults': 10
                                });
                                request.execute(function (response) {
                                    $.each(response.messages, function () {
                                        var messageRequest = gapi.client.gmail.users.messages.get({
                                            'userId': 'me',
                                            'id': this.id
                                        });
                                        messageRequest.execute(appendMessageRow);
                                    });
                                });
                            }

                            function appendMessageRow(message) {
                                $('.table-inbox tbody').append(
                                    '<tr>\
            <td>'+ getHeader(message.payload.headers, 'From') + '</td>\
            <td>\
              <a href="#message-modal-' + message.id +
                                    '" data-toggle="modal" id="message-link-' + message.id + '">' +
                                    getHeader(message.payload.headers, 'Subject') +
                                    '</a>\
            </td>\
            <td>'+ getHeader(message.payload.headers, 'Date') + '</td>\
          </tr>'
                                );
                                var reply_to = (getHeader(message.payload.headers, 'Reply-to') !== '' ?
                                    getHeader(message.payload.headers, 'Reply-to') :
                                    getHeader(message.payload.headers, 'From')).replace(/\"/g, '&quot;');

                                var reply_subject = 'Re: ' + getHeader(message.payload.headers, 'Subject').replace(/\"/g, '&quot;');
                                $('body').append(
                                    '<div class="modal fade" id="message-modal-' + message.id +
                                    '" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\
            <div class="modal-dialog modal-lg">\
              <div class="modal-content">\
                <div class="modal-header">\
                  <button type="button"\
                          class="close"\
                          data-dismiss="modal"\
                          aria-label="Close">\
                    <span aria-hidden="true">&times;</span></button>\
                  <h4 class="modal-title" id="myModalLabel">' +
                                    getHeader(message.payload.headers, 'Subject') +
                                    '</h4>\
                </div>\
                <div class="modal-body">\
                  <iframe id="message-iframe-'+ message.id + '" srcdoc="<p>Loading...</p>">\
                  </iframe>\
                </div>\
                <div class="modal-footer">\
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\
                  <button type="button" class="btn btn-primary reply-button" data-dismiss="modal" data-toggle="modal" data-target="#reply-modal"\
                  onclick="fillInReply(\
                    \''+ reply_to + '\', \
                    \''+ reply_subject + '\', \
                    \''+ getHeader(message.payload.headers, 'Message-ID') + '\'\
                    );"\
                  >Reply</button>\
                </div>\
              </div>\
            </div>\
          </div>'
                                );
                                $('#message-link-' + message.id).on('click', function () {
                                    var ifrm = $('#message-iframe-' + message.id)[0].contentWindow.document;
                                    $('body', ifrm).html(getBody(message.payload));
                                });
                            }

                            function sendEmail() {
                                $('#send-button').addClass('disabled');

                                sendMessage(
                                    {
                                        'To': $('#compose-to').val(),
                                        'Subject': $('#compose-subject').val()
                                    },
                                    $('#compose-message').val(),
                                    composeTidy
                                );

                                return false;
                            }

                            function composeTidy() {
                                // $('#compose-modal').modal('hide');

                                $('#compose-to').val('');
                                $('#compose-subject').val('');
                                $('#compose-message').val('');

                                $('#send-button').removeClass('disabled');
                            }

                            function sendReply() {
                                $('#reply-button').addClass('disabled');

                                sendMessage(
                                    {
                                        'To': $('#reply-to').val(),
                                        'Subject': $('#reply-subject').val(),
                                        'In-Reply-To': $('#reply-message-id').val()
                                    },
                                    $('#reply-message').val(),
                                    replyTidy
                                );

                                return false;
                            }

                            function replyTidy() {
                                $('#reply-modal').modal('hide');

                                $('#reply-message').val('');

                                $('#reply-button').removeClass('disabled');
                            }

                            function fillInReply(to, subject, message_id) {
                                $('#reply-to').val(to);
                                $('#reply-subject').val(subject);
                                $('#reply-message-id').val(message_id);
                            }

                            function sendMessage(headers_obj, message, callback) {
                                var email = '';

                                for (var header in headers_obj)
                                    email += header += ": " + headers_obj[header] + "\r\n";

                                email += "\r\n" + message;

                                var sendRequest = gapi.client.gmail.users.messages.send({
                                    'userId': 'me',
                                    'resource': {
                                        'raw': window.btoa(email).replace(/\+/g, '-').replace(/\//g, '_')
                                    }
                                });

                                return sendRequest.execute(callback);
                            }

                            function getHeader(headers, index) {
                                var header = '';
                                $.each(headers, function () {
                                    if (this.name.toLowerCase() === index.toLowerCase()) {
                                        header = this.value;
                                    }
                                });
                                return header;
                            }

                            function getBody(message) {
                                var encodedBody = '';
                                if (typeof message.parts === 'undefined') {
                                    encodedBody = message.body.data;
                                }
                                else {
                                    encodedBody = getHTMLPart(message.parts);
                                }
                                encodedBody = encodedBody.replace(/-/g, '+').replace(/_/g, '/').replace(/\s/g, '');
                                return decodeURIComponent(escape(window.atob(encodedBody)));
                            }

                            function getHTMLPart(arr) {
                                for (var x = 0; x <= arr.length; x++) {
                                    if (typeof arr[x].parts === 'undefined') {
                                        if (arr[x].mimeType === 'text/html') {
                                            return arr[x].body.data;
                                        }
                                    }
                                    else {
                                        return getHTMLPart(arr[x].parts);
                                    }
                                }
                                return '';
                            }
                        </script> -->

                        <!-------------------------------DEBUGGING THE JS ---------------------------------------->

                    </div>
                </div>
            </div>
        </div>

        <div class="scroll-down">
            <p>scroll down</p>
            <div class="down-arrow"></div>
        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
    <script src="./assets/javacript/dist/choreographer.min.js"></script>

    <script type="text/javascript" src="assets/javascript/giphyAPI.js"> </script>
    <script type="text/javascript" src="assets/javascript/gmailAPI.js"> </script>
    <script src="assets/javacript/logic.js"></script>
</body>


</html>